mixin cite(key, number=null)
    span(data-key=key, data-page=number).citation

mixin bibliography(format)
    h1 Bibliography
    div(data-format=format)#bibliography
    script.
        const Cite = require('citation-js')
        var data = new Cite()
        var bibliography = document.getElementById('bibliography')
        for (var i of document.getElementsByClassName('citation')) {
            let key = i.getAttribute('data-key') 
            let pg = i.getAttribute('data-page') 
            data.add(key)
            for (var j of data.data) {
                if (j.id == key) {
                    if(pg != null) {
                        i.innerHTML = `(${j.author[0].family}, ${j.issued["date-parts"][0][0]}, p. ${pg})`
                    } else {
                        i.innerHTML = `(${j.author[0].family}, ${j.issued["date-parts"][0][0]})`
                    }
                }
            }
        }
        var output = data.get({
            format: 'string',
            type: 'html',
            style: bibliography.getAttribute('data-format'),
            lange: 'en-US'
        })

        bibliography.innerHTML = output
        
mixin stepSVG(step, path)
    //- Allows to import progressive (=animated) SVGs into slideshow.
    //- If a SVG has elements with a ``steps`` attributes, then
    //- ``+stepSVG(4, 'my.svg')`` with only display this element if 4 is
    //- included into ``steps``.
    
    -
      var text = fs.readFileSync(basedir + path, 'utf8')
      var parsedHtml = cheerio.load(text)
      parsedHtml('*[steps]').each(function (i, c) {
        var steps = c.attribs.steps
        if (steps.indexOf('--') > -1) {
           var [min, max] = steps.split("--")
           min =  (min === '') ? 0 : parseInt(min)
           max =  (max === '') ? 10000 : parseInt(max)
           if ((step < min) || (step > max)) {
             c.attribs['style'] = 'display: none;'
           }
        } else if (c.attribs.steps.split(',').indexOf(step.toString()) === -1) {
          c.attribs['style'] = 'display: none;'
        }
      })
    div(width="100%")!= parsedHtml.html()
